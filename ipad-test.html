<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPad Network Test</title>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            background: #0f172a;
            color: #fff;
            padding: 20px;
        }

        .box {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 15px 0;
            border-radius: 15px;
        }

        .good {
            border-color: #34a853;
        }

        .bad {
            border-color: #ef4444;
        }

        h2 {
            color: #38bdf8;
            font-size: 18px;
        }

        .btn {
            background: #38bdf8;
            color: #000;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }

        .status {
            font-size: 14px;
            margin: 10px 0;
        }

        pre {
            background: #1e293b;
            padding: 10px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <h1 style="color: #38bdf8;">üîç iPad Network Diagnostics</h1>

    <div class="box">
        <h2>Your iPad Info</h2>
        <div class="status">User Agent: <span id="ua"></span></div>
        <div class="status">Current URL: <span id="url"></span></div>
        <div class="status">Hostname: <span id="host"></span></div>
    </div>

    <div class="box">
        <h2>Mac Server Test</h2>
        <input type="text" id="mac-ip" value="192.168.0.7"
            style="width: 150px; padding: 8px; border-radius: 5px; border: 1px solid #38bdf8; background: #1e293b; color: #fff;">
        <button class="btn" onclick="testConnection()">TEST CONNECTION</button>
        <div id="test-result" style="margin-top: 15px;"></div>
    </div>

    <div class="box">
        <h2>üìã Troubleshooting Tips</h2>
        <div style="font-size: 13px; line-height: 1.6;">
            <p>‚úÖ <strong>Make sure</strong>: python3 server.py is running on your Mac</p>
            <p>‚úÖ <strong>Same WiFi</strong>: iPad and Mac must be on the same network</p>
            <p>‚úÖ <strong>Firewall</strong>: Mac's firewall might be blocking port 5001</p>
            <p>‚úÖ <strong>IP Address</strong>: Verify 192.168.0.7 is correct (check server terminal)</p>
        </div>
    </div>

    <script>
        document.getElementById('ua').innerText = navigator.userAgent;
        document.getElementById('url').innerText = window.location.href;
        document.getElementById('host').innerText = window.location.hostname;

        function testConnection() {
            var ip = document.getElementById('mac-ip').value;
            var resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<div style="color: #fbbf24;">‚è≥ Testing connection to ' + ip + ':5001...</div>';

            var xhr = new XMLHttpRequest();
            var startTime = Date.now();

            xhr.open('GET', 'http://' + ip + ':5001/stats', true);
            xhr.timeout = 5000; // 5 second timeout

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    var elapsed = Date.now() - startTime;
                    if (xhr.status == 200) {
                        var data = JSON.parse(xhr.responseText);
                        resultDiv.innerHTML = '<div style="color: #34a853; font-weight: bold;">‚úÖ SUCCESS!</div>' +
                            '<div style="margin-top: 10px;">Response time: ' + elapsed + 'ms</div>' +
                            '<pre>' + JSON.stringify(data, null, 2) + '</pre>' +
                            '<button class="btn" onclick="location.href=\'apps/companion.html\'">Open Mac Companion</button>';
                    } else {
                        resultDiv.innerHTML = '<div style="color: #ef4444; font-weight: bold;">‚ùå CONNECTION FAILED</div>' +
                            '<div style="margin-top: 10px;">Status: ' + xhr.status + '</div>' +
                            '<div style="font-size: 13px; margin-top: 10px;">Possible issues:</div>' +
                            '<div style="font-size: 12px;">‚Ä¢ Server not running on Mac</div>' +
                            '<div style="font-size: 12px;">‚Ä¢ Wrong IP address</div>' +
                            '<div style="font-size: 12px;">‚Ä¢ iPad and Mac on different WiFi networks</div>' +
                            '<div style="font-size: 12px;">‚Ä¢ Mac firewall blocking port 5001</div>';
                    }
                }
            };

            xhr.ontimeout = function () {
                resultDiv.innerHTML = '<div style="color: #ef4444; font-weight: bold;">‚ùå TIMEOUT</div>' +
                    '<div style="margin-top: 10px;">The iPad cannot reach your Mac.</div>' +
                    '<div style="font-size: 13px; margin-top: 10px;">This usually means:</div>' +
                    '<div style="font-size: 12px;">‚Ä¢ iPad and Mac are on different WiFi networks</div>' +
                    '<div style="font-size: 12px;">‚Ä¢ Server is not running (check Terminal)</div>';
            };

            xhr.onerror = function () {
                resultDiv.innerHTML = '<div style="color: #ef4444; font-weight: bold;">‚ùå NETWORK ERROR</div>' +
                    '<div style="margin-top: 10px;">Could not connect to Mac.</div>';
            };

            xhr.send();
        }
    </script>
</body>

</html>